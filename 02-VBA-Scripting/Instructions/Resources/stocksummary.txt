Sub StockScan()
Dim i As LongLong
Dim x As LongLong
Dim k As LongLong

Dim datarow As LongLong

Dim header As String
Dim lastrow As LongLong
Dim lastcol As LongLong

Dim stock_open As Double
Dim stock_close As Double
Dim totVol As Double

Dim thisTik As String
Dim nextTik As String


    MsgBox ("Welcome To The Stock Scanner...")

num_sheets = ThisWorkbook.Worksheets.Count 'Tells me how many sheets in the workbook

    For k = 1 To num_sheets
    Sheets(k).Activate
    Sheets(k).Select
        With ActiveSheet
        '****************************************************************************************************
                lastrow = .Cells(Rows.Count, 1).End(xlUp).Row
                
                'Creating header for data row
                .Range("J1").Value = "Ticker"
                .Range("K1").Value = "Yearly Change"
                .Range("L1").Value = "Yearly Percent Change"
                .Range("M1").Value = "Total Stock Volume"
                
                
                'Add conditional formating that will highlight positive change in green and negative change red
                
                stock_start_row = 2
                stock_open = 0
                datarow = 2
                
                
                
                For i = 2 To lastrow
                
                'Get the ticker symbol
                
                x = i + 1
                thisTik = .Cells(i, 1).Value
                nextTik = .Cells(x, 1).Value
                
                
                    If (thisTik <> nextTik) Then
                       stock_open = .Cells(stock_start_row, 3).Value
                       stock_close = .Cells(i, 6).Value
                
                       'Get the yearly change from the opening price at the beginning of the year to the closing price at the end of that year
                       stock_yr_change = stock_close - stock_open
                       
                       'Get the percent change from opening price at the beginning of the year to the close price at the end of the year
                       
                       'Gotta catch that divison by zero son!! I see you
                       If (stock_open <> 0) Then
                       stock_per_change = stock_yr_change / stock_open
                       Else
                       stock_per_change = 0
                       End If
                       
                       'The total volume of the stock
                       totVol = totVol + Cells(i, 7)
                       .Cells(datarow, 10).Value = thisTik
                       .Cells(datarow, 11).Value = stock_yr_change
                       .Cells(datarow, 12).Value = stock_per_change
                       .Cells(datarow, 13).Value = totVol
                              
                       'Conditional formatting that will highlight positive change in green and negative change in red For Yearly Change and Yearly Percentage Change
                       If (stock_yr_change > 0) Then
                        .Cells(datarow, 11).Interior.ColorIndex = 4
                       ElseIf (stock_yr_change < 0) Then
                        .Cells(datarow, 11).Interior.ColorIndex = 3
                       Else
                       .Cells(datarow, 11).Interior.ColorIndex = 0
                       End If
                       
                       If (stock_per_change > 0) Then
                        .Cells(datarow, 12).Interior.ColorIndex = 4
                       ElseIf (stock_per_change < 0) Then
                        .Cells(datarow, 12).Interior.ColorIndex = 3
                       Else
                       .Cells(datarow, 12).Interior.ColorIndex = 0
                       End If
                       
                
                       .Cells(datarow, 12).NumberFormat = "0.00%"
                 
                       
                       totVol = 0
                       datarow = datarow + 1
                       stock_start_row = x
                    Else
                      totVol = totVol + .Cells(i, 7)
                    
                    End If
                    
                
                Next i
                
        '*******************************************************************************************
        End With
    Next k
End Sub

